const fs = require('fs-extra');
const path = require('path');
const moment = require('moment-timezone');

const DUAS_PATH = path.join(__dirname, "..", "data", "duas-subscribers.json");

function loadDuasData() {
    try {
        if (!fs.existsSync(DUAS_PATH)) {
            if (!fs.existsSync(path.dirname(DUAS_PATH)))
                fs.mkdirSync(path.dirname(DUAS_PATH), { recursive: true });
            fs.writeFileSync(
                DUAS_PATH,
                JSON.stringify({ subscribers: [], enabled: true }, null, 2),
            );
            return { subscribers: [], enabled: true };
        }
        const data = JSON.parse(fs.readFileSync(DUAS_PATH, "utf8") || "{}");
        return {
            subscribers: Array.isArray(data.subscribers) ? data.subscribers : [],
            enabled: data.enabled !== undefined ? data.enabled : true,
        };
    } catch {
        return { subscribers: [], enabled: true };
    }
}

function saveDuasData(data) {
    try {
        fs.writeFileSync(DUAS_PATH, JSON.stringify(data, null, 2));
    } catch { }
}

const islamicDuas = [
    {
        title: "Ø¯Ø¹Ø§Ø¡ Ø§Ù„ØµØ¨Ø§Ø­",
        dua: "Ø§Ù„Ù„ÙŽÙ‘Ù‡ÙÙ…ÙŽÙ‘ Ø¨ÙÙƒÙŽ Ø£ÙŽØµÙ’Ø¨ÙŽØ­Ù’Ù†ÙŽØ§ØŒ ÙˆÙŽØ¨ÙÙƒÙŽ Ø£ÙŽÙ…Ù’Ø³ÙŽÙŠÙ’Ù†ÙŽØ§ØŒ ÙˆÙŽØ¨ÙÙƒÙŽ Ù†ÙŽØ­Ù’ÙŠÙŽØ§ØŒ ÙˆÙŽØ¨ÙÙƒÙŽ Ù†ÙŽÙ…ÙÙˆØªÙØŒ ÙˆÙŽØ¥ÙÙ„ÙŽÙŠÙ’ÙƒÙŽ Ø§Ù„Ù†ÙÙ‘Ø´ÙÙˆØ±Ù. Ø§Ù„Ù„ÙŽÙ‘Ù‡ÙÙ…ÙŽÙ‘ Ø¥ÙÙ†ÙÙ‘ÙŠ Ø£ÙŽØ³Ù’Ø£ÙŽÙ„ÙÙƒÙŽ Ø®ÙŽÙŠÙ’Ø±ÙŽ Ù‡ÙŽØ°ÙŽØ§ Ø§Ù„Ù’ÙŠÙŽÙˆÙ’Ù…Ù ÙÙŽØªÙ’Ø­ÙŽÙ‡ÙØŒ ÙˆÙŽÙ†ÙŽØµÙ’Ø±ÙŽÙ‡ÙØŒ ÙˆÙŽÙ†ÙÙˆØ±ÙŽÙ‡ÙØŒ ÙˆÙŽØ¨ÙŽØ±ÙŽÙƒÙŽØªÙŽÙ‡ÙØŒ ÙˆÙŽÙ‡ÙØ¯ÙŽØ§Ù‡ÙØŒ ÙˆÙŽØ£ÙŽØ¹ÙÙˆØ°Ù Ø¨ÙÙƒÙŽ Ù…ÙÙ†Ù’ Ø´ÙŽØ±ÙÙ‘ Ù…ÙŽØ§ ÙÙÙŠÙ‡Ù ÙˆÙŽØ´ÙŽØ±ÙÙ‘ Ù…ÙŽØ§ Ø¨ÙŽØ¹Ù’Ø¯ÙŽÙ‡Ù.",
        category: "ØµØ¨Ø§Ø­",
    },
    {
        title: "Ø¯Ø¹Ø§Ø¡ Ø§Ù„Ù…Ø³Ø§Ø¡",
        dua: "Ø§Ù„Ù„ÙŽÙ‘Ù‡ÙÙ…ÙŽÙ‘ Ø¨ÙÙƒÙŽ Ø£ÙŽÙ…Ù’Ø³ÙŽÙŠÙ’Ù†ÙŽØ§ØŒ ÙˆÙŽØ¨ÙÙƒÙŽ Ø£ÙŽØµÙ’Ø¨ÙŽØ­Ù’Ù†ÙŽØ§ØŒ ÙˆÙŽØ¨ÙÙƒÙŽ Ù†ÙŽØ­Ù’ÙŠÙŽØ§ØŒ ÙˆÙŽØ¨ÙÙƒÙŽ Ù†ÙŽÙ…ÙÙˆØªÙØŒ ÙˆÙŽØ¥ÙÙ„ÙŽÙŠÙ’ÙƒÙŽ Ø§Ù„Ù’Ù…ÙŽØµÙÙŠØ±Ù. Ø£ÙŽÙ…Ù’Ø³ÙŽÙŠÙ’Ù†ÙŽØ§ ÙˆÙŽØ£ÙŽÙ…Ù’Ø³ÙŽÙ‰ Ø§Ù„Ù’Ù…ÙÙ„Ù’ÙƒÙ Ù„ÙÙ„ÙŽÙ‘Ù‡ÙØŒ ÙˆÙŽØ§Ù„Ù’Ø­ÙŽÙ…Ù’Ø¯Ù Ù„ÙÙ„ÙŽÙ‘Ù‡ÙØŒ Ù„ÙŽØ§ Ø¥ÙÙ„ÙŽÙ‡ÙŽ Ø¥ÙÙ„ÙŽÙ‘Ø§ Ø§Ù„Ù„Ù‡Ù ÙˆÙŽØ­Ù’Ø¯ÙŽÙ‡Ù Ù„ÙŽØ§ Ø´ÙŽØ±ÙÙŠÙƒÙŽ Ù„ÙŽÙ‡ÙØŒ Ù„ÙŽÙ‡Ù Ø§Ù„Ù’Ù…ÙÙ„Ù’ÙƒÙ ÙˆÙŽÙ„ÙŽÙ‡Ù Ø§Ù„Ù’Ø­ÙŽÙ…Ù’Ø¯Ù ÙˆÙŽÙ‡ÙÙˆÙ‡ Ø¹ÙŽÙ„ÙŽÙ‰ ÙƒÙÙ„ÙÙ‘ Ø´ÙŽÙŠÙ’Ø¡Ù Ù‚ÙŽØ¯ÙÙŠØ±ÙŒ.",
        category: "Ù…Ø³Ø§Ø¡",
    },
    {
        title: "Ø¯Ø¹Ø§Ø¡ Ø§Ù„Ø±Ø²Ù‚",
        dua: "Ø§Ù„Ù„ÙŽÙ‘Ù‡ÙÙ…ÙŽÙ‘ Ø§ÙƒÙ’ÙÙÙ†ÙÙŠ Ø¨ÙØ­ÙŽÙ„ÙŽØ§Ù„ÙÙƒÙŽ Ø¹ÙŽÙ†Ù’ Ø­ÙŽØ±ÙŽØ§Ù…ÙÙƒÙŽØŒ ÙˆÙŽØ£ÙŽØºÙ’Ù†ÙÙ†ÙÙŠ Ø¨ÙÙÙŽØ¶Ù’Ù„ÙÙƒÙŽ Ø¹ÙŽÙ…ÙŽÙ‘Ù†Ù’ Ø³ÙÙˆÙŽØ§ÙƒÙŽ. Ø§Ù„Ù„ÙŽÙ‘Ù‡ÙÙ…ÙŽÙ‘ Ø¥ÙÙ†ÙÙ‘ÙŠ Ø£ÙŽØ³Ù’Ø£ÙŽÙ„ÙÙƒÙŽ Ø±ÙØ²Ù’Ù‚Ù‹Ø§ ÙˆÙŽØ§Ø³ÙØ¹Ù‹Ø§ Ø·ÙŽÙŠÙÙ‘Ø¨Ù‹Ø§ Ù…ÙÙ†Ù’ Ø±ÙØ²Ù’Ù‚ÙÙƒÙŽØŒ ÙˆÙŽÙŠÙŽØ³ÙÙ‘Ø±Ù’ Ù„ÙÙŠ Ø·ÙŽÙ„ÙŽØ¨ÙŽÙ‡ÙØŒ ÙˆÙŽØ§Ø¬Ù’Ø¹Ø¹Ù„Ù’Ù‡Ù Ù„ÙÙŠ Ù…ÙŽØµÙ’Ø¯ÙŽØ±ÙŽ Ø®ÙŽÙŠÙ’Ø±Ù ÙˆÙŽØ¨ÙŽØ±ÙŽÙƒÙŽØ©Ù.",
        category: "Ø±Ø²Ù‚",
    },
    {
        title: "Ø³ÙŠØ¯ Ø§Ù„Ø§Ø³ØªØºÙØ§Ø±",
        dua: "Ø§Ù„Ù„ÙŽÙ‘Ù‡ÙÙ…ÙŽÙ‘ Ø£ÙŽÙ†Ù’ØªÙŽ Ø±ÙŽØ¨ÙÙ‘ÙŠ Ù„ÙŽØ§ Ø¥ÙÙ„ÙŽÙ‡ÙŽ Ø¥ÙÙ„ÙŽÙ‘Ø§ Ø£ÙŽÙ†Ù’ØªÙŽØŒ Ø®ÙŽÙ„ÙŽÙ‚Ù’ØªÙŽÙ†ÙÙŠ ÙˆÙŽØ£ÙŽÙ†ÙŽØ§ Ø¹ÙŽØ¨Ù’Ø¯ÙÙƒÙŽØŒ ÙˆÙŽØ£ÙŽÙ†ÙŽØ§ Ø¹ÙŽÙ„ÙŽÙ‰ Ø¹ÙŽÙ‡Ù’Ø¯ÙÙƒÙŽ ÙˆÙŽÙˆÙŽØ¹Ù’Ø¯ÙÙƒÙŽ Ù…ÙŽØ§ Ø§Ø³Ù’ØªÙŽØ·ÙŽØ¹Ù’ØªÙØŒ Ø£ÙŽØ¹ÙÙˆØ°Ù Ø¨ÙÙƒÙŽ Ù…ÙÙ†Ù’ Ø´ÙŽØ±ÙÙ‘ Ù…ÙŽØ§ ØµÙŽÙ†ÙŽØ¹Ù’ØªÙØŒ Ø£ÙŽØ¨ÙÙˆØ¡Ù Ù„ÙŽÙƒÙŽ Ø¨ÙÙ†ÙØ¹Ù’Ù…ÙŽØªÙÙƒÙŽ Ø¹ÙŽÙ„ÙŽÙŠÙŽÙ‘ØŒ ÙˆÙŽØ£ÙŽØ¨ÙÙˆØ¡Ù Ø¨ÙØ°ÙŽÙ†Ù’Ø¨ÙÙŠ ÙÙŽØ§ØºÙ’ÙÙØ±Ù’ Ù„ÙÙŠ ÙÙŽØ¥ÙÙ†ÙŽÙ‘Ù‡Ù Ù„ÙŽØ§ ÙŠÙŽØºÙ’ÙÙØ±Ù Ø§Ù„Ø°ÙÙ‘Ù†ÙÙˆØ¨ÙŽ Ø¥ÙÙ„ÙŽÙ‘Ø§ Ø£ÙŽÙ†Ù’ØªÙŽ.",
        category: "Ø§Ø³ØªØºÙØ§Ø±",
    },
    {
        title: "Ø¯Ø¹Ø§Ø¡ Ø§Ù„Ø´ÙØ§Ø¡",
        dua: "Ø§Ù„Ù„ÙŽÙ‘Ù‡ÙÙ…ÙŽÙ‘ Ø±ÙŽØ¨ÙŽÙ‘ Ø§Ù„Ù†ÙŽÙ‘Ø§Ø³Ù Ø£ÙŽØ°Ù’Ù‡ÙØ¨Ù Ø§Ù„Ù’Ø¨ÙŽØ§Ø³ÙŽØŒ Ø§Ø´Ù’ÙÙÙ‡Ù ÙˆÙŽØ£ÙŽÙ†Ù’ØªÙŽ Ø§Ù„Ø´ÙŽÙ‘Ø§ÙÙÙŠØŒ Ù„ÙŽØ§ Ø´ÙÙÙŽØ§Ø¡ÙŽ Ø¥ÙÙ„ÙŽÙ‘Ø§ Ø´ÙÙØ§Ø¤ÙÙƒÙŽØŒ Ø´ÙÙÙŽØ§Ø¡Ù‹ Ù„ÙŽØ§ ÙŠÙØºÙŽØ§Ø¯ÙØ±Ù Ø³ÙŽÙ‚ÙŽÙ…Ù‹Ø§.",
        category: "Ø´ÙØ§Ø¡",
    },
    {
        title: "Ø¯Ø¹Ø§Ø¡ Ø¬Ø§Ù…Ø¹",
        dua: "Ø±ÙŽØ¨ÙŽÙ‘Ù†ÙŽØ§ Ø¢ØªÙÙ†ÙŽØ§ ÙÙÙŠ Ø§Ù„Ø¯ÙÙ‘Ù†Ù’ÙŠÙŽØ§ Ø­ÙŽØ³ÙŽÙ†ÙŽØ©Ù‹ ÙˆÙŽÙÙÙŠ Ø§Ù„Ù’Ø¢Ø®ÙØ±ÙŽØ©Ù Ø­ÙŽØ³ÙŽÙ†ÙŽØ©Ù‹ ÙˆÙŽÙ‚ÙÙ†ÙŽØ§ Ø¹ÙŽØ°ÙŽØ§Ø¨ÙŽ Ø§Ù„Ù†ÙŽÙ‘Ø§Ø±Ù.",
        category: "Ø¬Ø§Ù…Ø¹",
    },
    {
        title: "Ø¯Ø¹Ø§Ø¡ Ø§Ù„Ù‡Ø¯Ø§ÙŠØ©",
        dua: "Ø§Ù„Ù„Ù‡Ù… Ø¥Ù†ÙŠ Ø£Ø³Ø£Ù„Ùƒ Ø§Ù„Ù‡Ø¯Ù‰ ÙˆØ§Ù„ØªÙ‚Ù‰ ÙˆØ§Ù„Ø¹ÙØ§Ù ÙˆØ§Ù„ØºÙ†Ù‰ØŒ Ø§Ù„Ù„Ù‡Ù… Ø¢ØªÙ Ù†ÙØ³ÙŠ ØªÙ‚ÙˆØ§Ù‡Ø§ ÙˆØ²ÙƒÙ‡Ø§ Ø£Ù†Øª Ø®ÙŠØ± Ù…Ù† Ø²ÙƒØ§Ù‡Ø§ Ø£Ù†Øª ÙˆÙ„ÙŠÙ‡Ø§ ÙˆÙ…ÙˆÙ„Ø§Ù‡Ø§.",
        category: "Ù‡Ø¯Ø§ÙŠØ©",
    },
    {
        title: "Ø¯Ø¹Ø§Ø¡ ØªÙŠØ³ÙŠØ± Ø§Ù„Ø£Ù…ÙˆØ±",
        dua: "Ø§Ù„Ù„Ù‡Ù… Ù„Ø§ Ø³Ù‡Ù„ Ø¥Ù„Ø§ Ù…Ø§ Ø¬Ø¹Ù„ØªÙ‡ Ø³Ù‡Ù„Ø§Ù‹ØŒ ÙˆØ£Ù†Øª ØªØ¬Ø¹Ù„ Ø§Ù„Ø­Ø²Ù† Ø¥Ø°Ø§ Ø´Ø¦Øª Ø³Ù‡Ù„Ø§Ù‹ØŒ Ø§Ù„Ù„Ù‡Ù… ÙŠØ³Ù‘Ø± Ù„ÙŠ Ø£Ù…Ø±ÙŠ ÙˆØ§Ø´Ø±Ø­ Ù„ÙŠ ØµØ¯Ø±ÙŠ.",
        category: "ØªÙŠØ³ÙŠØ±",
    },
    {
        title: "Ø¯Ø¹Ø§Ø¡ ÙŠÙˆÙ… Ø§Ù„Ø¬Ù…Ø¹Ø©",
        dua: "Ø§Ù„Ù„ÙŽÙ‘Ù‡ÙÙ…ÙŽÙ‘ ÙÙÙŠ ÙŠÙŽÙˆÙ’Ù…Ù Ø§Ù„Ù’Ø¬ÙÙ…ÙØ¹ÙŽØ©ÙØŒ Ø§Ø¬Ù’Ø¹ÙŽÙ„Ù’Ù†ÙŽØ§ Ù…ÙÙ…ÙŽÙ‘Ù†Ù’ Ø¹ÙŽÙÙŽÙˆÙ’ØªÙŽ Ø¹ÙŽÙ†Ù’Ù‡ÙÙ…Ù’ØŒ ÙˆÙŽØ±ÙŽØ¶ÙÙŠØªÙŽ Ø¹ÙŽÙ†Ù’Ù‡ÙÙ…Ù’ØŒ ÙˆÙŽØºÙŽÙÙŽØ±Ù’ØªÙŽ Ù„ÙŽÙ‡ÙÙ…Ù’ØŒ ÙˆÙŽØ­ÙŽØ±ÙŽÙ‘Ù…Ù’ØªÙŽÙ‡ÙÙ…Ù’ Ø¹ÙŽÙ„ÙŽÙ‰ Ø§Ù„Ù†ÙŽÙ‘Ø§Ø±ÙØŒ ÙˆÙŽÙƒÙŽØªÙŽØ¨Ù’ØªÙŽ Ù„ÙŽÙ‡ÙÙ…Ù Ø§Ù„Ù’Ø¬ÙŽÙ†ÙŽÙ‘Ø©ÙŽ.",
        category: "Ø¬Ù…Ø¹Ø©",
    },
    {
        title: "Ø³Ø§Ø¹Ø© Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© ÙŠÙˆÙ… Ø§Ù„Ø¬Ù…Ø¹Ø©",
        dua: "Ø§Ù„Ù„ÙŽÙ‘Ù‡ÙÙ…ÙŽÙ‘ Ù…ÙŽØ§ Ù‚ÙŽØ³ÙŽÙ…Ù’ØªÙŽ ÙÙÙŠ Ù‡ÙŽØ°ÙŽØ§ Ø§Ù„Ù’ÙŠÙŽÙˆÙ’Ù…Ù Ù…ÙÙ†Ù’ Ø®ÙŽÙŠÙ’Ø±Ù ÙˆÙŽØµÙØ­ÙŽÙ‘Ø©Ù ÙˆÙŽØ³ÙŽØ¹ÙŽØ©Ù Ø±ÙØ²Ù’Ù‚Ù ÙÙŽØ§Ø¬Ù’Ø¹ÙŽÙ„Ù’ Ù„ÙŽÙ†ÙŽØ§ Ù…ÙÙ†Ù’Ù‡Ù Ù†ÙŽØµÙÙŠØ¨Ù‹Ø§ØŒ ÙˆÙŽÙ…Ø§ Ø£ÙŽÙ†Ù’Ø²ÙŽÙ„Ù’ØªÙŽ ÙÙÙŠÙ‡Ù Ù…ÙÙ†Ù’ Ø´ÙŽØ±ÙÙ‘ ÙˆÙŽØ¨ÙŽÙ„ÙŽØ§Ø¡Ù ÙˆÙŽÙÙØªÙ’Ù†ÙŽØ©Ù ÙÙŽØ§ØµÙ’Ø±ÙÙÙ’Ù‡Ù Ø¹ÙŽÙ†ÙŽÙ‘Ø§ ÙˆÙŽØ¹ÙŽÙ†Ù’ Ø¬ÙŽÙ…ÙÙŠØ¹Ù Ø§Ù„Ù’Ù…ÙØ³Ù’Ù„ÙÙ…ÙÙŠÙ†ÙŽ.",
        category: "Ø¬Ù…Ø¹Ø©",
    },
    {
        title: "Ù†ÙˆØ± Ø§Ù„Ø¬Ù…Ø¹Ø©",
        dua: "Ø§Ù„Ù„ÙŽÙ‘Ù‡ÙÙ…ÙŽÙ‘ Ù†ÙŽÙˆÙÙ‘Ø±Ù’ Ù‚ÙÙ„ÙÙˆØ¨ÙŽÙ†ÙŽØ§ Ø¨ÙØ§Ù„Ù’Ø¥ÙÙŠÙ…ÙŽØ§Ù†ÙØŒ ÙˆÙŽØ²ÙŽÙŠÙÙ‘Ù†Ù’ Ø£ÙŽÙŠÙŽÙ‘Ø§Ù…ÙŽÙ†ÙŽØ§ Ø¨ÙØ§Ù„Ø³ÙŽÙ‘Ø¹ÙŽØ§Ø¯ÙŽØ©ÙØŒ ÙˆÙŽØ§Ø¬Ù’Ø¹Ø¹Ù„Ù’ ÙŠÙŽÙˆÙ’Ù…ÙŽ Ø§Ù„Ù’Ø¬ÙÙ…ÙØ¹ÙŽØ©Ù Ù†ÙÙˆØ±Ù‹Ø§ Ù„ÙŽÙ†ÙŽØ§ ÙˆÙŽÙ…ÙŽØºÙ’ÙÙØ±ÙŽØ©Ù‹.",
        category: "Ø¬Ù…Ø¹Ø©",
    },
    {
        title: "Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ø¬Ù…Ø¹Ø©",
        dua: "ÙŠØ§ Ø±Ø¨ ÙÙŠ ÙŠÙˆÙ… Ø§Ù„Ø¬Ù…Ø¹Ø© ÙˆØ¹Ø¯Øª Ø¹Ø¨Ø§Ø¯Ùƒ Ø¨Ù‚Ø¨ÙˆÙ„ Ø¯Ø¹ÙˆØ§ØªÙ‡Ù…ØŒ Ø§Ù„Ù„Ù‡Ù… Ø§Ø±Ø­Ù… Ù…ÙˆØªØ§Ù†Ø§ØŒ ÙˆØ§Ø´Ù Ù…Ø±Ø¶Ø§Ù†Ø§ØŒ ÙˆØ§Ø³ØªØ¬Ø¨ Ù„Ø¯Ø¹Ø§Ø¦Ù†Ø§ØŒ ÙˆØ§ØºÙØ± Ù„Ù†Ø§ Ø°Ù†ÙˆØ¨Ù†Ø§.",
        category: "Ø¬Ù…Ø¹Ø©",
    },
    {
        title: "Ø¯Ø¹Ø§Ø¡ Ø§Ù„Ù†ÙˆÙ…",
        dua: "Ø¨ÙØ§Ø³Ù…ÙÙƒÙŽ Ø±ÙŽØ¨ÙÙ‘ÙŠ ÙˆÙŽØ¶ÙŽØ¹Ù’ØªÙ Ø¬ÙŽÙ†Ù’Ø¨ÙÙŠØŒ ÙˆÙŽØ¨ÙÙƒÙŽ Ø£ÙŽØ±Ù’ÙÙŽØ¹ÙÙ‡ÙØŒ ÙÙŽØ¥ÙÙ†Ù’ Ø£ÙŽÙ…Ù’Ø³ÙŽÙƒÙ’ØªÙŽ Ù†ÙŽÙÙ’Ø³ÙÙŠ ÙÙŽØ§Ø±Ù’Ø­ÙŽÙ…Ù’Ù‡ÙŽØ§ØŒ ÙˆÙŽØ¥ÙÙ†Ù’ Ø£ÙŽØ±Ù’Ø³ÙŽÙ„Ù’ØªÙŽÙ‡ÙŽØ§ ÙÙŽØ§Ø­Ù’ÙÙŽØ¸Ù’Ù‡ÙŽØ§ Ø¨ÙÙ…ÙŽØ§ ØªÙŽØ­Ù’ÙÙŽØ¸Ù Ø¨ÙÙ‡Ù Ø¹ÙØ¨ÙŽØ§Ø¯ÙŽÙƒÙŽ Ø§Ù„ØµÙŽÙ‘Ø§Ù„ÙØ­ÙÙŠÙ†ÙŽ.",
        category: "Ù†ÙˆÙ…",
    },
    {
        title: "Ø£Ø°ÙƒØ§Ø± Ø§Ù„Ù†ÙˆÙ…",
        dua: "Ø§Ù„Ù„ÙŽÙ‘Ù‡ÙÙ…ÙŽÙ‘ Ù‚ÙÙ†ÙÙŠ Ø¹ÙŽØ°ÙŽØ§Ø¨ÙŽÙƒÙŽ ÙŠÙŽÙˆÙ’Ù…ÙŽ ØªÙŽØ¨Ù’Ø¹ÙŽØ«Ù Ø¹ÙØ¨ÙŽØ§Ø¯ÙŽÙƒÙŽ. (Ø«Ù„Ø§Ø« Ù…Ø±Ø§Øª)",
        category: "Ù†ÙˆÙ…",
    },
    {
        title: "Ù‚Ø¨Ù„ Ø§Ù„Ù†ÙˆÙ…",
        dua: "Ø¨ÙØ§Ø³Ù’Ù…ÙÙƒÙŽ Ø§Ù„Ù„ÙŽÙ‘Ù‡ÙÙ…ÙŽÙ‘ Ø£ÙŽÙ…ÙÙˆØªÙ ÙˆÙŽØ£ÙŽØ­Ù’ÙŠÙŽØ§.",
        category: "Ù†ÙˆÙ…",
    },
    {
        title: "Ø¯Ø¹Ø§Ø¡ Ø§Ù„Ø³ÙƒÙŠÙ†Ø©",
        dua: "Ø§Ù„Ù„Ù‡Ù… Ø±Ø¨ Ø§Ù„Ø³Ù…Ø§ÙˆØ§Øª ÙˆØ±Ø¨ Ø§Ù„Ø£Ø±Ø¶ ÙˆØ±Ø¨ Ø§Ù„Ø¹Ø±Ø´ Ø§Ù„Ø¹Ø¸ÙŠÙ…ØŒ Ø±Ø¨Ù†Ø§ ÙˆØ±Ø¨ ÙƒÙ„ Ø´ÙŠØ¡ØŒ ÙØ§Ù„Ù‚ Ø§Ù„Ø­Ø¨ ÙˆØ§Ù„Ù†ÙˆÙ‰ØŒ ÙˆÙ…Ù†Ø²Ù„ Ø§Ù„ØªÙˆØ±Ø§Ø© ÙˆØ§Ù„Ø¥Ù†Ø¬ÙŠÙ„ ÙˆØ§Ù„ÙØ±Ù‚Ø§Ù†ØŒ Ø£Ø¹ÙˆØ° Ø¨Ùƒ Ù…Ù† Ø´Ø± ÙƒÙ„ Ø´ÙŠØ¡ Ø£Ù†Øª Ø¢Ø®Ø° Ø¨Ù†Ø§ØµÙŠØªÙ‡.",
        category: "Ù†ÙˆÙ…",
    },
];

function getRandomDua(category = null) {
    let filtered = islamicDuas;
    if (category) {
        filtered = islamicDuas.filter((d) => d.category === category);
        if (filtered.length === 0) filtered = islamicDuas;
    } else {
        filtered = islamicDuas.filter(
            (d) => d.category !== "Ø¬Ù…Ø¹Ø©" && d.category !== "Ù†ÙˆÙ…",
        );
    }
    return filtered[Math.floor(Math.random() * filtered.length)];
}

const duasLastSent = {};

function startDuasScheduler(sock, helpers) {
    const { sendWithChannelButton, config } = helpers;

    setInterval(async () => {
        try {
            const data = loadDuasData();
            if (!data.enabled) return;

            const now = moment().tz("Africa/Casablanca");
            const hour = now.hours();
            const minute = now.minutes();
            const dateStr = now.format("YYYY-MM-DD");
            const isFriday = now.day() === 5;

            const targetHours = [7, 9, 11, 12, 17, 19, 22];

            if (minute === 0 && targetHours.includes(hour)) {
                const key = `${dateStr}_${hour}`;
                if (duasLastSent[key]) return;
                duasLastSent[key] = true;

                // Cleanup
                Object.keys(duasLastSent).forEach((k) => {
                    if (!k.startsWith(dateStr)) delete duasLastSent[k];
                });

                // Build the message
                let msg = "";

                if (isFriday && hour === 9) {
                    msg = `â•­â”â”â”ã€˜ ðŸ“– *Ù†ÙˆØ± Ø§Ù„Ø¬Ù…Ø¹Ø©* ðŸ“– ã€™â”â”â”â•®\nâ”ƒ âœ¨ *ØªØ°ÙƒÙŠØ± Ø¨Ø³ÙˆØ±Ø© Ø§Ù„ÙƒÙ‡Ù*\nâ”ƒ ðŸ•¯ï¸ *Ù‚Ø§Ù„ ï·º:* Â«Ù…Ù† Ù‚Ø±Ø£ Ø³ÙˆØ±Ø© Ø§Ù„ÙƒÙ‡Ù ÙÙŠ ÙŠÙˆÙ… \nâ”ƒ Ø§Ù„Ø¬Ù…Ø¹Ø© Ø£Ø¶Ø§Ø¡ Ù„Ù‡ Ù…Ù† Ø§Ù„Ù†ÙˆØ± Ù…Ø§ Ø¨ÙŠÙ† Ø§Ù„Ø¬Ù…Ø¹ØªÙŠÙ†Â»\nâ•°â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•¯\n\nðŸ’Ž *Ù„Ø§ ØªÙ†Ø³ÙˆØ§ Ø³Ù†Ù† Ø§Ù„Ø¬Ù…Ø¹Ø©:*\n   â—¦ Ø§Ù„ØºØ³Ù„ ÙˆØ§Ù„Ø·ÙŠØ¨ ðŸš¿\n   â—¦ Ø³ÙˆØ±Ø© Ø§Ù„ÙƒÙ‡Ù ðŸ“–\n   â—¦ ÙƒØ«Ø±Ø© Ø§Ù„ØµÙ„Ø§Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø¨ÙŠ ï·º ðŸ“¿\n\nðŸŽ§ *Ø§Ø³ØªÙ…Ø¹ Ù„Ø³ÙˆØ±Ø© Ø§Ù„ÙƒÙ‡Ù Ø¨ØµÙˆØª Ù…Ø´Ø§Ø±ÙŠ Ø§Ù„Ø¹ÙØ§Ø³ÙŠ:*`;
                } else if (isFriday && hour === 11) {
                    msg = `â•­â”â”â”ã€˜ ðŸ•Œ *Ù†Ø¯Ø§Ø¡ Ø§Ù„Ø¬Ù…Ø¹Ø©* ðŸ•Œ ã€™â”â”â”â•®\nâ”ƒ âœ¨ *Ø§Ù„Ø§Ø³ØªØ¹Ø¯Ø§Ø¯ Ù„ØµÙ„Ø§Ø© Ø§Ù„Ø¬Ù…Ø¹Ø©*\nâ”ƒ  ðŸ•Œ *Ù…ÙˆØ¹Ø¯ ØµØ¹ÙˆØ¯ Ø§Ù„Ù…Ù†Ø¨Ø± ÙŠÙ‚ØªØ±Ø¨*\nâ•°â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•¯\n\nðŸ’¡ *Ø¢Ø¯Ø§Ø¨ ØµÙ„Ø§Ø© Ø§Ù„Ø¬Ù…Ø¹Ø©:*\n 1ï¸âƒ£ Ø§Ù„Ø§ØºØªØ³Ø§Ù„ ÙˆØ§Ù„ØªØ·ÙŠØ¨ ÙˆÙ„Ø¨Ø³ Ø£Ø­Ø³Ù† Ø§Ù„Ø«ÙŠØ§Ø¨.\n 2ï¸âƒ£ *Ø§Ù„ØªØ¨ÙƒÙŠØ±:* (Ø§Ù„ØªØ¨ÙƒÙŠØ± ÙŠØ¶Ø§Ø¹Ù Ø§Ù„Ø£Ø¬Ø±).\n 3ï¸âƒ£ *Ø§Ù„Ø¥Ù†ØµØ§Øª Ù„Ù„Ø®Ø·Ø¨Ø©:* (Ù…Ù† Ù‚Ø§Ù„ Ù„ØµØ§Ø­Ø¨Ù‡ Ø£Ù†ØµØª ÙÙ‚Ø¯ Ù„ØºØ§).\n\nâš”ï¸ ${config.botName}`;
                } else {
                    let dua;
                    if (hour === 22) {
                        dua = getRandomDua("Ù†ÙˆÙ…");
                    } else if (isFriday) {
                        dua = getRandomDua("Ø¬Ù…Ø¹Ø©");
                    } else {
                        dua = getRandomDua();
                    }
                    const title = hour === 22 ? "Ø¯Ø¹Ø§Ø¡ Ø§Ù„Ù†ÙˆÙ…" : isFriday ? "Ø¯Ø¹Ø§Ø¡ ÙŠÙˆÙ… Ø§Ù„Ø¬Ù…Ø¹Ø©" : "Ø¯Ø¹Ø§Ø¡ Ø§Ù„ÙŠÙˆÙ…";
                    msg = `ðŸ¤² *${title}*\n\nðŸ“¿ ${dua.dua}`;
                }

                if (!msg) return;

                // â”€â”€ 1. WhatsApp: opted-in subscribers only â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                if (data.subscribers && data.subscribers.length > 0) {
                    for (const id of data.subscribers) {
                        try {
                            await sendWithChannelButton(sock, id, msg);
                            // Special: Friday Quran audio
                            if (isFriday && hour === 9) {
                                await sock.sendMessage(id, {
                                    audio: { url: "https://cdn.islamic.network/quran/audio-surah/128/ar.alafasy/18.mp3" },
                                    mimetype: "audio/mpeg",
                                    ptt: false,
                                });
                            }
                        } catch (e) { }
                    }
                }

                // â”€â”€ 2. Telegram: all users (auto) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                try {
                    const tgPath = require('path').join(__dirname, '..', 'data', 'tg_users.json');
                    const fs2 = require('fs-extra');
                    if (fs2.existsSync(tgPath)) {
                        const tgUsers = JSON.parse(fs2.readFileSync(tgPath, 'utf8') || '[]');
                        if (tgUsers.length > 0 && config.telegramToken) {
                            const { sendTelegramPrayerReminder } = require('./telegram');
                            for (const tgId of tgUsers) {
                                try {
                                    await new Promise(r => setTimeout(r, 200));
                                    await sendTelegramPrayerReminder(tgId, msg);
                                } catch (e) { }
                            }
                        }
                    }
                } catch (e) { }

                // â”€â”€ 3. Facebook: all users (auto) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                try {
                    const fbPath = require('path').join(__dirname, '..', 'data', 'fb_users.json');
                    const fs3 = require('fs-extra');
                    if (fs3.existsSync(fbPath)) {
                        const fbUsers = JSON.parse(fs3.readFileSync(fbPath, 'utf8') || '[]');
                        if (fbUsers.length > 0 && config.fbPageAccessToken) {
                            const { sendFacebookMessage } = require('./facebook');
                            for (const fbId of fbUsers) {
                                try {
                                    await new Promise(r => setTimeout(r, 300));
                                    await sendFacebookMessage(fbId, msg.replace(/\*/g, '').replace(/_/g, ''));
                                } catch (e) { }
                            }
                        }
                    }
                } catch (e) { }
            }
        } catch (e) { }
    }, 60000);
}


const quranSessions = {};

module.exports = {
    loadDuasData,
    saveDuasData,
    islamicDuas,
    getRandomDua,
    quranSessions,
    startDuasScheduler
};
