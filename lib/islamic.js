const fs = require('fs-extra');
const path = require('path');
const moment = require('moment-timezone');

const DUAS_PATH = path.join(__dirname, "..", "data", "duas-subscribers.json");

function loadDuasData() {
    try {
        if (!fs.existsSync(DUAS_PATH)) {
            if (!fs.existsSync(path.dirname(DUAS_PATH)))
                fs.mkdirSync(path.dirname(DUAS_PATH), { recursive: true });
            fs.writeFileSync(
                DUAS_PATH,
                JSON.stringify({ subscribers: [], enabled: true }, null, 2),
            );
            return { subscribers: [], enabled: true };
        }
        const data = JSON.parse(fs.readFileSync(DUAS_PATH, "utf8") || "{}");
        return {
            subscribers: Array.isArray(data.subscribers) ? data.subscribers : [],
            enabled: data.enabled !== undefined ? data.enabled : true,
        };
    } catch {
        return { subscribers: [], enabled: true };
    }
}

function saveDuasData(data) {
    try {
        fs.writeFileSync(DUAS_PATH, JSON.stringify(data, null, 2));
    } catch { }
}

const islamicDuas = [
    {
        title: "Ø¯Ø¹Ø§Ø¡ Ø§Ù„ØµØ¨Ø§Ø­",
        dua: "Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø¨ÙÙƒÙ Ø£ÙØµÙ’Ø¨ÙØ­Ù’Ù†ÙØ§ØŒ ÙˆÙØ¨ÙÙƒÙ Ø£ÙÙ…Ù’Ø³ÙÙŠÙ’Ù†ÙØ§ØŒ ÙˆÙØ¨ÙÙƒÙ Ù†ÙØ­Ù’ÙŠÙØ§ØŒ ÙˆÙØ¨ÙÙƒÙ Ù†ÙÙ…ÙÙˆØªÙØŒ ÙˆÙØ¥ÙÙ„ÙÙŠÙ’ÙƒÙ Ø§Ù„Ù†ÙÙ‘Ø´ÙÙˆØ±Ù. Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø¥ÙÙ†ÙÙ‘ÙŠ Ø£ÙØ³Ù’Ø£ÙÙ„ÙÙƒÙ Ø®ÙÙŠÙ’Ø±Ù Ù‡ÙØ°ÙØ§ Ø§Ù„Ù’ÙŠÙÙˆÙ’Ù…Ù ÙÙØªÙ’Ø­ÙÙ‡ÙØŒ ÙˆÙÙ†ÙØµÙ’Ø±ÙÙ‡ÙØŒ ÙˆÙÙ†ÙÙˆØ±ÙÙ‡ÙØŒ ÙˆÙØ¨ÙØ±ÙÙƒÙØªÙÙ‡ÙØŒ ÙˆÙÙ‡ÙØ¯ÙØ§Ù‡ÙØŒ ÙˆÙØ£ÙØ¹ÙÙˆØ°Ù Ø¨ÙÙƒÙ Ù…ÙÙ†Ù’ Ø´ÙØ±ÙÙ‘ Ù…ÙØ§ ÙÙÙŠÙ‡Ù ÙˆÙØ´ÙØ±ÙÙ‘ Ù…ÙØ§ Ø¨ÙØ¹Ù’Ø¯ÙÙ‡Ù.",
        category: "ØµØ¨Ø§Ø­",
    },
    {
        title: "Ø¯Ø¹Ø§Ø¡ Ø§Ù„Ù…Ø³Ø§Ø¡",
        dua: "Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø¨ÙÙƒÙ Ø£ÙÙ…Ù’Ø³ÙÙŠÙ’Ù†ÙØ§ØŒ ÙˆÙØ¨ÙÙƒÙ Ø£ÙØµÙ’Ø¨ÙØ­Ù’Ù†ÙØ§ØŒ ÙˆÙØ¨ÙÙƒÙ Ù†ÙØ­Ù’ÙŠÙØ§ØŒ ÙˆÙØ¨ÙÙƒÙ Ù†ÙÙ…ÙÙˆØªÙØŒ ÙˆÙØ¥ÙÙ„ÙÙŠÙ’ÙƒÙ Ø§Ù„Ù’Ù…ÙØµÙÙŠØ±Ù. Ø£ÙÙ…Ù’Ø³ÙÙŠÙ’Ù†ÙØ§ ÙˆÙØ£ÙÙ…Ù’Ø³ÙÙ‰ Ø§Ù„Ù’Ù…ÙÙ„Ù’ÙƒÙ Ù„ÙÙ„ÙÙ‘Ù‡ÙØŒ ÙˆÙØ§Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù Ù„ÙÙ„ÙÙ‘Ù‡ÙØŒ Ù„ÙØ§ Ø¥ÙÙ„ÙÙ‡Ù Ø¥ÙÙ„ÙÙ‘Ø§ Ø§Ù„Ù„Ù‡Ù ÙˆÙØ­Ù’Ø¯ÙÙ‡Ù Ù„ÙØ§ Ø´ÙØ±ÙÙŠÙƒÙ Ù„ÙÙ‡ÙØŒ Ù„ÙÙ‡Ù Ø§Ù„Ù’Ù…ÙÙ„Ù’ÙƒÙ ÙˆÙÙ„ÙÙ‡Ù Ø§Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù ÙˆÙÙ‡ÙÙˆÙ‡ Ø¹ÙÙ„ÙÙ‰ ÙƒÙÙ„ÙÙ‘ Ø´ÙÙŠÙ’Ø¡Ù Ù‚ÙØ¯ÙÙŠØ±ÙŒ.",
        category: "Ù…Ø³Ø§Ø¡",
    },
    {
        title: "Ø¯Ø¹Ø§Ø¡ Ø§Ù„Ø±Ø²Ù‚",
        dua: "Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø§ÙƒÙ’ÙÙÙ†ÙÙŠ Ø¨ÙØ­ÙÙ„ÙØ§Ù„ÙÙƒÙ Ø¹ÙÙ†Ù’ Ø­ÙØ±ÙØ§Ù…ÙÙƒÙØŒ ÙˆÙØ£ÙØºÙ’Ù†ÙÙ†ÙÙŠ Ø¨ÙÙÙØ¶Ù’Ù„ÙÙƒÙ Ø¹ÙÙ…ÙÙ‘Ù†Ù’ Ø³ÙÙˆÙØ§ÙƒÙ. Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø¥ÙÙ†ÙÙ‘ÙŠ Ø£ÙØ³Ù’Ø£ÙÙ„ÙÙƒÙ Ø±ÙØ²Ù’Ù‚Ù‹Ø§ ÙˆÙØ§Ø³ÙØ¹Ù‹Ø§ Ø·ÙÙŠÙÙ‘Ø¨Ù‹Ø§ Ù…ÙÙ†Ù’ Ø±ÙØ²Ù’Ù‚ÙÙƒÙØŒ ÙˆÙÙŠÙØ³ÙÙ‘Ø±Ù’ Ù„ÙÙŠ Ø·ÙÙ„ÙØ¨ÙÙ‡ÙØŒ ÙˆÙØ§Ø¬Ù’Ø¹Ø¹Ù„Ù’Ù‡Ù Ù„ÙÙŠ Ù…ÙØµÙ’Ø¯ÙØ±Ù Ø®ÙÙŠÙ’Ø±Ù ÙˆÙØ¨ÙØ±ÙÙƒÙØ©Ù.",
        category: "Ø±Ø²Ù‚",
    },
    {
        title: "Ø³ÙŠØ¯ Ø§Ù„Ø§Ø³ØªØºÙØ§Ø±",
        dua: "Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø£ÙÙ†Ù’ØªÙ Ø±ÙØ¨ÙÙ‘ÙŠ Ù„ÙØ§ Ø¥ÙÙ„ÙÙ‡Ù Ø¥ÙÙ„ÙÙ‘Ø§ Ø£ÙÙ†Ù’ØªÙØŒ Ø®ÙÙ„ÙÙ‚Ù’ØªÙÙ†ÙÙŠ ÙˆÙØ£ÙÙ†ÙØ§ Ø¹ÙØ¨Ù’Ø¯ÙÙƒÙØŒ ÙˆÙØ£ÙÙ†ÙØ§ Ø¹ÙÙ„ÙÙ‰ Ø¹ÙÙ‡Ù’Ø¯ÙÙƒÙ ÙˆÙÙˆÙØ¹Ù’Ø¯ÙÙƒÙ Ù…ÙØ§ Ø§Ø³Ù’ØªÙØ·ÙØ¹Ù’ØªÙØŒ Ø£ÙØ¹ÙÙˆØ°Ù Ø¨ÙÙƒÙ Ù…ÙÙ†Ù’ Ø´ÙØ±ÙÙ‘ Ù…ÙØ§ ØµÙÙ†ÙØ¹Ù’ØªÙØŒ Ø£ÙØ¨ÙÙˆØ¡Ù Ù„ÙÙƒÙ Ø¨ÙÙ†ÙØ¹Ù’Ù…ÙØªÙÙƒÙ Ø¹ÙÙ„ÙÙŠÙÙ‘ØŒ ÙˆÙØ£ÙØ¨ÙÙˆØ¡Ù Ø¨ÙØ°ÙÙ†Ù’Ø¨ÙÙŠ ÙÙØ§ØºÙ’ÙÙØ±Ù’ Ù„ÙÙŠ ÙÙØ¥ÙÙ†ÙÙ‘Ù‡Ù Ù„ÙØ§ ÙŠÙØºÙ’ÙÙØ±Ù Ø§Ù„Ø°ÙÙ‘Ù†ÙÙˆØ¨Ù Ø¥ÙÙ„ÙÙ‘Ø§ Ø£ÙÙ†Ù’ØªÙ.",
        category: "Ø§Ø³ØªØºÙØ§Ø±",
    },
    {
        title: "Ø¯Ø¹Ø§Ø¡ Ø§Ù„Ø´ÙØ§Ø¡",
        dua: "Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø±ÙØ¨ÙÙ‘ Ø§Ù„Ù†ÙÙ‘Ø§Ø³Ù Ø£ÙØ°Ù’Ù‡ÙØ¨Ù Ø§Ù„Ù’Ø¨ÙØ§Ø³ÙØŒ Ø§Ø´Ù’ÙÙÙ‡Ù ÙˆÙØ£ÙÙ†Ù’ØªÙ Ø§Ù„Ø´ÙÙ‘Ø§ÙÙÙŠØŒ Ù„ÙØ§ Ø´ÙÙÙØ§Ø¡Ù Ø¥ÙÙ„ÙÙ‘Ø§ Ø´ÙÙØ§Ø¤ÙÙƒÙØŒ Ø´ÙÙÙØ§Ø¡Ù‹ Ù„ÙØ§ ÙŠÙØºÙØ§Ø¯ÙØ±Ù Ø³ÙÙ‚ÙÙ…Ù‹Ø§.",
        category: "Ø´ÙØ§Ø¡",
    },
    {
        title: "Ø¯Ø¹Ø§Ø¡ Ø¬Ø§Ù…Ø¹",
        dua: "Ø±ÙØ¨ÙÙ‘Ù†ÙØ§ Ø¢ØªÙÙ†ÙØ§ ÙÙÙŠ Ø§Ù„Ø¯ÙÙ‘Ù†Ù’ÙŠÙØ§ Ø­ÙØ³ÙÙ†ÙØ©Ù‹ ÙˆÙÙÙÙŠ Ø§Ù„Ù’Ø¢Ø®ÙØ±ÙØ©Ù Ø­ÙØ³ÙÙ†ÙØ©Ù‹ ÙˆÙÙ‚ÙÙ†ÙØ§ Ø¹ÙØ°ÙØ§Ø¨Ù Ø§Ù„Ù†ÙÙ‘Ø§Ø±Ù.",
        category: "Ø¬Ø§Ù…Ø¹",
    },
    {
        title: "Ø¯Ø¹Ø§Ø¡ Ø§Ù„Ù‡Ø¯Ø§ÙŠØ©",
        dua: "Ø§Ù„Ù„Ù‡Ù… Ø¥Ù†ÙŠ Ø£Ø³Ø£Ù„Ùƒ Ø§Ù„Ù‡Ø¯Ù‰ ÙˆØ§Ù„ØªÙ‚Ù‰ ÙˆØ§Ù„Ø¹ÙØ§Ù ÙˆØ§Ù„ØºÙ†Ù‰ØŒ Ø§Ù„Ù„Ù‡Ù… Ø¢ØªÙ Ù†ÙØ³ÙŠ ØªÙ‚ÙˆØ§Ù‡Ø§ ÙˆØ²ÙƒÙ‡Ø§ Ø£Ù†Øª Ø®ÙŠØ± Ù…Ù† Ø²ÙƒØ§Ù‡Ø§ Ø£Ù†Øª ÙˆÙ„ÙŠÙ‡Ø§ ÙˆÙ…ÙˆÙ„Ø§Ù‡Ø§.",
        category: "Ù‡Ø¯Ø§ÙŠØ©",
    },
    {
        title: "Ø¯Ø¹Ø§Ø¡ ØªÙŠØ³ÙŠØ± Ø§Ù„Ø£Ù…ÙˆØ±",
        dua: "Ø§Ù„Ù„Ù‡Ù… Ù„Ø§ Ø³Ù‡Ù„ Ø¥Ù„Ø§ Ù…Ø§ Ø¬Ø¹Ù„ØªÙ‡ Ø³Ù‡Ù„Ø§Ù‹ØŒ ÙˆØ£Ù†Øª ØªØ¬Ø¹Ù„ Ø§Ù„Ø­Ø²Ù† Ø¥Ø°Ø§ Ø´Ø¦Øª Ø³Ù‡Ù„Ø§Ù‹ØŒ Ø§Ù„Ù„Ù‡Ù… ÙŠØ³Ù‘Ø± Ù„ÙŠ Ø£Ù…Ø±ÙŠ ÙˆØ§Ø´Ø±Ø­ Ù„ÙŠ ØµØ¯Ø±ÙŠ.",
        category: "ØªÙŠØ³ÙŠØ±",
    },
    {
        title: "Ø¯Ø¹Ø§Ø¡ ÙŠÙˆÙ… Ø§Ù„Ø¬Ù…Ø¹Ø©",
        dua: "Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ ÙÙÙŠ ÙŠÙÙˆÙ’Ù…Ù Ø§Ù„Ù’Ø¬ÙÙ…ÙØ¹ÙØ©ÙØŒ Ø§Ø¬Ù’Ø¹ÙÙ„Ù’Ù†ÙØ§ Ù…ÙÙ…ÙÙ‘Ù†Ù’ Ø¹ÙÙÙÙˆÙ’ØªÙ Ø¹ÙÙ†Ù’Ù‡ÙÙ…Ù’ØŒ ÙˆÙØ±ÙØ¶ÙÙŠØªÙ Ø¹ÙÙ†Ù’Ù‡ÙÙ…Ù’ØŒ ÙˆÙØºÙÙÙØ±Ù’ØªÙ Ù„ÙÙ‡ÙÙ…Ù’ØŒ ÙˆÙØ­ÙØ±ÙÙ‘Ù…Ù’ØªÙÙ‡ÙÙ…Ù’ Ø¹ÙÙ„ÙÙ‰ Ø§Ù„Ù†ÙÙ‘Ø§Ø±ÙØŒ ÙˆÙÙƒÙØªÙØ¨Ù’ØªÙ Ù„ÙÙ‡ÙÙ…Ù Ø§Ù„Ù’Ø¬ÙÙ†ÙÙ‘Ø©Ù.",
        category: "Ø¬Ù…Ø¹Ø©",
    },
    {
        title: "Ø³Ø§Ø¹Ø© Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© ÙŠÙˆÙ… Ø§Ù„Ø¬Ù…Ø¹Ø©",
        dua: "Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ù…ÙØ§ Ù‚ÙØ³ÙÙ…Ù’ØªÙ ÙÙÙŠ Ù‡ÙØ°ÙØ§ Ø§Ù„Ù’ÙŠÙÙˆÙ’Ù…Ù Ù…ÙÙ†Ù’ Ø®ÙÙŠÙ’Ø±Ù ÙˆÙØµÙØ­ÙÙ‘Ø©Ù ÙˆÙØ³ÙØ¹ÙØ©Ù Ø±ÙØ²Ù’Ù‚Ù ÙÙØ§Ø¬Ù’Ø¹ÙÙ„Ù’ Ù„ÙÙ†ÙØ§ Ù…ÙÙ†Ù’Ù‡Ù Ù†ÙØµÙÙŠØ¨Ù‹Ø§ØŒ ÙˆÙÙ…Ø§ Ø£ÙÙ†Ù’Ø²ÙÙ„Ù’ØªÙ ÙÙÙŠÙ‡Ù Ù…ÙÙ†Ù’ Ø´ÙØ±ÙÙ‘ ÙˆÙØ¨ÙÙ„ÙØ§Ø¡Ù ÙˆÙÙÙØªÙ’Ù†ÙØ©Ù ÙÙØ§ØµÙ’Ø±ÙÙÙ’Ù‡Ù Ø¹ÙÙ†ÙÙ‘Ø§ ÙˆÙØ¹ÙÙ†Ù’ Ø¬ÙÙ…ÙÙŠØ¹Ù Ø§Ù„Ù’Ù…ÙØ³Ù’Ù„ÙÙ…ÙÙŠÙ†Ù.",
        category: "Ø¬Ù…Ø¹Ø©",
    },
    {
        title: "Ù†ÙˆØ± Ø§Ù„Ø¬Ù…Ø¹Ø©",
        dua: "Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ù†ÙÙˆÙÙ‘Ø±Ù’ Ù‚ÙÙ„ÙÙˆØ¨ÙÙ†ÙØ§ Ø¨ÙØ§Ù„Ù’Ø¥ÙÙŠÙ…ÙØ§Ù†ÙØŒ ÙˆÙØ²ÙÙŠÙÙ‘Ù†Ù’ Ø£ÙÙŠÙÙ‘Ø§Ù…ÙÙ†ÙØ§ Ø¨ÙØ§Ù„Ø³ÙÙ‘Ø¹ÙØ§Ø¯ÙØ©ÙØŒ ÙˆÙØ§Ø¬Ù’Ø¹Ø¹Ù„Ù’ ÙŠÙÙˆÙ’Ù…Ù Ø§Ù„Ù’Ø¬ÙÙ…ÙØ¹ÙØ©Ù Ù†ÙÙˆØ±Ù‹Ø§ Ù„ÙÙ†ÙØ§ ÙˆÙÙ…ÙØºÙ’ÙÙØ±ÙØ©Ù‹.",
        category: "Ø¬Ù…Ø¹Ø©",
    },
    {
        title: "Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ø¬Ù…Ø¹Ø©",
        dua: "ÙŠØ§ Ø±Ø¨ ÙÙŠ ÙŠÙˆÙ… Ø§Ù„Ø¬Ù…Ø¹Ø© ÙˆØ¹Ø¯Øª Ø¹Ø¨Ø§Ø¯Ùƒ Ø¨Ù‚Ø¨ÙˆÙ„ Ø¯Ø¹ÙˆØ§ØªÙ‡Ù…ØŒ Ø§Ù„Ù„Ù‡Ù… Ø§Ø±Ø­Ù… Ù…ÙˆØªØ§Ù†Ø§ØŒ ÙˆØ§Ø´Ù Ù…Ø±Ø¶Ø§Ù†Ø§ØŒ ÙˆØ§Ø³ØªØ¬Ø¨ Ù„Ø¯Ø¹Ø§Ø¦Ù†Ø§ØŒ ÙˆØ§ØºÙØ± Ù„Ù†Ø§ Ø°Ù†ÙˆØ¨Ù†Ø§.",
        category: "Ø¬Ù…Ø¹Ø©",
    },
    {
        title: "Ø¯Ø¹Ø§Ø¡ Ø§Ù„Ù†ÙˆÙ…",
        dua: "Ø¨ÙØ§Ø³Ù…ÙÙƒÙ Ø±ÙØ¨ÙÙ‘ÙŠ ÙˆÙØ¶ÙØ¹Ù’ØªÙ Ø¬ÙÙ†Ù’Ø¨ÙÙŠØŒ ÙˆÙØ¨ÙÙƒÙ Ø£ÙØ±Ù’ÙÙØ¹ÙÙ‡ÙØŒ ÙÙØ¥ÙÙ†Ù’ Ø£ÙÙ…Ù’Ø³ÙÙƒÙ’ØªÙ Ù†ÙÙÙ’Ø³ÙÙŠ ÙÙØ§Ø±Ù’Ø­ÙÙ…Ù’Ù‡ÙØ§ØŒ ÙˆÙØ¥ÙÙ†Ù’ Ø£ÙØ±Ù’Ø³ÙÙ„Ù’ØªÙÙ‡ÙØ§ ÙÙØ§Ø­Ù’ÙÙØ¸Ù’Ù‡ÙØ§ Ø¨ÙÙ…ÙØ§ ØªÙØ­Ù’ÙÙØ¸Ù Ø¨ÙÙ‡Ù Ø¹ÙØ¨ÙØ§Ø¯ÙÙƒÙ Ø§Ù„ØµÙÙ‘Ø§Ù„ÙØ­ÙÙŠÙ†Ù.",
        category: "Ù†ÙˆÙ…",
    },
    {
        title: "Ø£Ø°ÙƒØ§Ø± Ø§Ù„Ù†ÙˆÙ…",
        dua: "Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ù‚ÙÙ†ÙÙŠ Ø¹ÙØ°ÙØ§Ø¨ÙÙƒÙ ÙŠÙÙˆÙ’Ù…Ù ØªÙØ¨Ù’Ø¹ÙØ«Ù Ø¹ÙØ¨ÙØ§Ø¯ÙÙƒÙ. (Ø«Ù„Ø§Ø« Ù…Ø±Ø§Øª)",
        category: "Ù†ÙˆÙ…",
    },
    {
        title: "Ù‚Ø¨Ù„ Ø§Ù„Ù†ÙˆÙ…",
        dua: "Ø¨ÙØ§Ø³Ù’Ù…ÙÙƒÙ Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø£ÙÙ…ÙÙˆØªÙ ÙˆÙØ£ÙØ­Ù’ÙŠÙØ§.",
        category: "Ù†ÙˆÙ…",
    },
    {
        title: "Ø¯Ø¹Ø§Ø¡ Ø§Ù„Ø³ÙƒÙŠÙ†Ø©",
        dua: "Ø§Ù„Ù„Ù‡Ù… Ø±Ø¨ Ø§Ù„Ø³Ù…Ø§ÙˆØ§Øª ÙˆØ±Ø¨ Ø§Ù„Ø£Ø±Ø¶ ÙˆØ±Ø¨ Ø§Ù„Ø¹Ø±Ø´ Ø§Ù„Ø¹Ø¸ÙŠÙ…ØŒ Ø±Ø¨Ù†Ø§ ÙˆØ±Ø¨ ÙƒÙ„ Ø´ÙŠØ¡ØŒ ÙØ§Ù„Ù‚ Ø§Ù„Ø­Ø¨ ÙˆØ§Ù„Ù†ÙˆÙ‰ØŒ ÙˆÙ…Ù†Ø²Ù„ Ø§Ù„ØªÙˆØ±Ø§Ø© ÙˆØ§Ù„Ø¥Ù†Ø¬ÙŠÙ„ ÙˆØ§Ù„ÙØ±Ù‚Ø§Ù†ØŒ Ø£Ø¹ÙˆØ° Ø¨Ùƒ Ù…Ù† Ø´Ø± ÙƒÙ„ Ø´ÙŠØ¡ Ø£Ù†Øª Ø¢Ø®Ø° Ø¨Ù†Ø§ØµÙŠØªÙ‡.",
        category: "Ù†ÙˆÙ…",
    },
];

function getRandomDua(category = null) {
    let filtered = islamicDuas;
    if (category) {
        filtered = islamicDuas.filter((d) => d.category === category);
        if (filtered.length === 0) filtered = islamicDuas;
    } else {
        filtered = islamicDuas.filter(
            (d) => d.category !== "Ø¬Ù…Ø¹Ø©" && d.category !== "Ù†ÙˆÙ…",
        );
    }
    return filtered[Math.floor(Math.random() * filtered.length)];
}

const duasLastSent = {};

function startDuasScheduler(sock, helpers) {
    const { sendWithChannelButton, config } = helpers;

    setInterval(async () => {
        try {
            const data = loadDuasData();
            if (!data.enabled || data.subscribers.length === 0) return;

            const now = moment().tz("Africa/Casablanca");
            const hour = now.hours();
            const minute = now.minutes();
            const dateStr = now.format("YYYY-MM-DD");
            const isFriday = now.day() === 5;

            const targetHours = [7, 9, 11, 12, 17, 19, 22];

            if (minute === 0 && targetHours.includes(hour)) {
                const key = `${dateStr}_${hour}`;
                if (duasLastSent[key]) return;
                duasLastSent[key] = true;

                // Cleanup
                Object.keys(duasLastSent).forEach((k) => {
                    if (!k.startsWith(dateStr)) delete duasLastSent[k];
                });

                // Special: Friday Morning Surah Al-Kahf
                if (isFriday && hour === 9) {
                    const kahfMsg = `â•­â”â”â”ã€˜ ğŸ“– *Ù†ÙˆØ± Ø§Ù„Ø¬Ù…Ø¹Ø©* ğŸ“– ã€™â”â”â”â•®\nâ”ƒ âœ¨ *ØªØ°ÙƒÙŠØ± Ø¨Ø³ÙˆØ±Ø© Ø§Ù„ÙƒÙ‡Ù*\nâ”ƒ ğŸ•¯ï¸ *Ù‚Ø§Ù„ ï·º:* Â«Ù…Ù† Ù‚Ø±Ø£ Ø³ÙˆØ±Ø© Ø§Ù„ÙƒÙ‡Ù ÙÙŠ ÙŠÙˆÙ… \nâ”ƒ Ø§Ù„Ø¬Ù…Ø¹Ø© Ø£Ø¶Ø§Ø¡ Ù„Ù‡ Ù…Ù† Ø§Ù„Ù†ÙˆØ± Ù…Ø§ Ø¨ÙŠÙ† Ø§Ù„Ø¬Ù…Ø¹ØªÙŠÙ†Â»\nâ•°â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•¯\n\nğŸ’ *Ù„Ø§ ØªÙ†Ø³ÙˆØ§ Ø³Ù†Ù† Ø§Ù„Ø¬Ù…Ø¹Ø©:*\n   â—¦ Ø§Ù„ØºØ³Ù„ ÙˆØ§Ù„Ø·ÙŠØ¨ ğŸš¿\n   â—¦ Ø³ÙˆØ±Ø© Ø§Ù„ÙƒÙ‡Ù ğŸ“–\n   â—¦ ÙƒØ«Ø±Ø© Ø§Ù„ØµÙ„Ø§Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø¨ÙŠ ï·º ğŸ“¿\n\nğŸ§ *Ø§Ø³ØªÙ…Ø¹ Ù„Ø³ÙˆØ±Ø© Ø§Ù„ÙƒÙ‡Ù Ø¨ØµÙˆØª Ù…Ø´Ø§Ø±ÙŠ Ø§Ù„Ø¹ÙØ§Ø³ÙŠ:*`;
                    for (const id of data.subscribers) {
                        try {
                            await sendWithChannelButton(sock, id, kahfMsg);
                            await sock.sendMessage(id, {
                                audio: {
                                    url: "https://cdn.islamic.network/quran/audio-surah/128/ar.alafasy/18.mp3",
                                },
                                mimetype: "audio/mpeg",
                                ptt: false,
                            });
                        } catch (e) { }
                    }
                    return;
                }

                // Special: Friday Prayer Reminder
                if (isFriday && hour === 11) {
                    const jumaaMsg = `â•­â”â”â”ã€˜ ğŸ•Œ *Ù†Ø¯Ø§Ø¡ Ø§Ù„Ø¬Ù…Ø¹Ø©* ğŸ•Œ ã€™â”â”â”â•®\nâ”ƒ âœ¨ *Ø§Ù„Ø§Ø³ØªØ¹Ø¯Ø§Ø¯ Ù„ØµÙ„Ø§Ø© Ø§Ù„Ø¬Ù…Ø¹Ø©*\nâ”ƒ  mosque  *Ù…ÙˆØ¹Ø¯ ØµØ¹ÙˆØ¯ Ø§Ù„Ù…Ù†Ø¨Ø± ÙŠÙ‚ØªØ±Ø¨*\nâ•°â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•¯\n\nğŸ’¡ *Ø¢Ø¯Ø§Ø¨ ØµÙ„Ø§Ø© Ø§Ù„Ø¬Ù…Ø¹Ø©:*\n 1ï¸âƒ£ Ø§Ù„Ø§ØºØªØ³Ø§Ù„ ÙˆØ§Ù„ØªØ·ÙŠØ¨ ÙˆÙ„Ø¨Ø³ Ø£Ø­Ø³Ù† Ø§Ù„Ø«ÙŠØ§Ø¨.\n 2ï¸âƒ£ *Ø§Ù„ØªØ¨ÙƒÙŠØ±:* (Ø§Ù„ØªØ¨ÙƒÙŠØ± ÙŠØ¶Ø§Ø¹Ù Ø§Ù„Ø£Ø¬Ø±).\n 3ï¸âƒ£ *Ø§Ù„Ø¥Ù†ØµØ§Øª Ù„Ù„Ø®Ø·Ø¨Ø©:* (Ù…Ù† Ù‚Ø§Ù„ Ù„ØµØ§Ø­Ø¨Ù‡ Ø£Ù†ØµØª ÙÙ‚Ø¯ Ù„ØºØ§).\n\nâš”ï¸ ${config.botName}`;
                    for (const id of data.subscribers) {
                        try {
                            await sendWithChannelButton(sock, id, jumaaMsg);
                        } catch (e) { }
                    }
                    return;
                }

                let dua, title;
                if (hour === 22) {
                    dua = getRandomDua("Ù†ÙˆÙ…");
                    title = "Ø¯Ø¹Ø§Ø¡ Ø§Ù„Ù†ÙˆÙ…";
                } else if (isFriday) {
                    dua = getRandomDua("Ø¬Ù…Ø¹Ø©");
                    title = "Ø¯Ø¹Ø§Ø¡ ÙŠÙˆÙ… Ø§Ù„Ø¬Ù…Ø¹Ø©";
                } else {
                    dua = getRandomDua();
                    title = "Ø¯Ø¹Ø§Ø¡ Ø§Ù„ÙŠÙˆÙ…";
                }

                const msg = `ğŸ¤² *${title}*\n\nğŸ“¿ ${dua.dua}`;
                for (const id of data.subscribers) {
                    try {
                        await sendWithChannelButton(sock, id, msg);
                    } catch (e) { }
                }
            }
        } catch (e) { }
    }, 60000);
}

const quranSessions = {};

module.exports = {
    loadDuasData,
    saveDuasData,
    islamicDuas,
    getRandomDua,
    quranSessions,
    startDuasScheduler
};
