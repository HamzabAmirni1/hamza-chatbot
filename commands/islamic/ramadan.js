const moment = require('moment-timezone');
const { sendWithChannelButton } = require('../lib/utils');
const config = require('../../config');

const ramadanData = {
    duas: [
        "ุงููููููููู ุงุฌูุนููู ุตูููุงููู ููููู ุตูููุงูู ุงูุตููุงุฆููููููุ ูู ููููุงููู ููููู ููููุงูู ุงููููุงุฆููููููุ ูู ููุจููููููู ููููู ุนููู ููููููุฉู ุงููุบูุงูููููููุ ูู ููุจู ููู ุฌูุฑูููู ููููู ููุง ุฅููููู ุงููุนูุงูููููููุ ูู ุงุนููู ุนููููู ููุง ุนูุงูููุงู ุนููู ุงููููุฌูุฑูููููู.",
        "ุงููููููููู ููุฑููุจูููู ููููู ุฅูููู ููุฑูุถูุงุชูููุ ูู ุฌููููุจูููู ููููู ูููู ุณูุฎูุทููู ูู ููููููุงุชูููุ ูู ูููููููููู ููููู ููููุฑูุงุกูุฉู ุขููุงุชูููุ ุจูุฑูุญูููุชููู ููุง ุฃูุฑูุญููู ุงูุฑููุงุญูููููู.",
        "ุงููููููููู ุงุฑูุฒูููููู ููููู ุงูุฐูููููู ูู ุงูุชููููุจููููุ ูู ุจูุงุนูุฏูููู ููููู ูููู ุงูุณููููุงููุฉู ูู ุงูุชูููููููููุ ูู ุงุฌูุนููู ููู ููุตููุจุงู ูููู ููููู ุฎูููุฑู ุชูููุฒููู ูููููุ ุจูุฌููุฏููู ููุง ุฃูุฌูููุฏู ุงููุฃูุฌูููุฏูููู.",
        "ุงููููููููู ูููููููู ููููู ุนูููู ุฅูููุงููุฉู ุฃูููุฑูููุ ูู ุฃูุฐูููููู ููููู ุญูููุงููุฉู ุฐูููุฑูููุ ูู ุฃูููุฒูุนูููู ููููู ููุฃูุฏูุงุกู ุดูููุฑููู ุจูููุฑูููููุ ูู ุงุญูููุธูููู ููููู ุจูุญูููุธููู ูู ุณูุชูุฑููู ููุง ุฃูุจูุตูุฑู ุงููููุงุธูุฑูููู.",
        "ุงููููููููู ุงุฌูุนูููููู ููููู ูููู ุงููููุณูุชูุบูููุฑููููุ ูู ุงุฌูุนูููููู ููููู ูููู ุนูุจูุงุฏููู ุงูุตููุงููุญูููู ุงููููุงููุชููููุ ูู ุงุฌูุนูููููู ููููู ูููู ุฃูููููููุงุฆููู ุงููููููุฑููุจููููุ ุจูุฑูุฃูููุชููู ููุง ุฃูุฑูุญููู ุงูุฑููุงุญูููููู.",
        "ุงููููููููู ููุง ุชูุฎูุฐูููููู ููููู ููุชูุนูุฑููุถู ููุนูุตูููุชูููุ ูู ููุง ุชูุถูุฑูุจูููู ุจูุณูููุงุทู ููููููุชูููุ ูู ุฒูุญูุฒูุญูููู ููููู ูููู ูููุฌูุจูุงุชู ุณูุฎูุทููู ุจูููููููู ูู ุฃูููุงุฏูููู ููุง ููููุชูููู ุฑูุบูุจูุฉู ุงูุฑููุงุบูุจูููู.",
        "ุงููููููููู ุฃูุนููููู ููููู ุนูููู ุตูููุงูููู ูู ููููุงููููุ ูู ุฌููููุจูููู ููููู ูููู ููููููุงุชููู ูู ุขุซูุงููููุ ูู ุงุฑูุฒูููููู ููููู ุฐูููุฑููู ุจูุฏูููุงููููุ ุจูุชูููููููููู ููุง ููุงุฏููู ุงููููุถููููููู.",
        "ุงููููููููู ุงุฑูุฒูููููู ููููู ุฑูุญูููุฉู ุงููุฃูููุชูุงููุ ูู ุฅูุทูุนูุงูู ุงูุทููุนูุงููุ ูู ุฅูููุดูุงุกู ุงูุณููููุงููุ ูู ุตูุญูุจูุฉู ุงููููุฑูุงููุ ุจูุทููููููู ููุง ููููุฌูุฃู ุงููุขููููููู.",
        "ุงููููููููู ุงุฌูุนููู ููู ููููู ููุตููุจุงู ูููู ุฑูุญูููุชููู ุงููููุงุณูุนูุฉูุ ูู ุงููุฏูููู ููููู ููุจูุฑูุงููููููู ุงูุณููุงุทูุนูุฉูุ ูู ุฎูุฐู ุจูููุงุตูููุชูู ุฅูููู ููุฑูุถูุงุชููู ุงููุฌูุงููุนูุฉูุ ุจูููุญูุจููุชููู ููุง ุฃููููู ุงููููุดูุชูุงููููู.",
        "ุงููููููููู ุงุฌูุนูููููู ููููู ูููู ุงููููุชููููููููููู ุนูููููููุ ูู ุงุฌูุนูููููู ููููู ูููู ุงููููุงุฆูุฒูููู ููุฏูููููุ ูู ุงุฌูุนูููููู ููููู ูููู ุงููููููุฑููุจูููู ุฅูููููููุ ุจูุฅูุญูุณูุงูููู ููุง ุบูุงููุฉู ุงูุทููุงููุจูููู."
    ],
    tips: [
        "๐ ุชุฐูุฑ ุฃู ุฑูุถุงู ุดูุฑ ุงูุชุบููุฑุ ูุงุจุฏุฃ ุจููุณู.",
        "๐ ุงุฌุนู ูู ูุฑุฏุงู ููููุงู ูู ุงููุฑุขู ุงููุฑูู ููุง ุชูุฌุฑู.",
        "๐ง ุงูุฅูุซุงุฑ ูู ุดุฑุจ ุงููุงุก ุจูู ุงูุฅูุทุงุฑ ูุงูุณุญูุฑ ูุชุฌูุจ ุงูุฌูุงู.",
        "๐ฅ ุงุจุฏุฃ ุฅูุทุงุฑู ุจุงูุชูุฑ ูุงููุงุก ููุง ูุนู ุงููุจู ๏ทบ.",
        "๐ฟ ุงุณุชุบู ููุช ุงููุฌุฑ ููุง ุจุนุฏู ููุฏุนุงุก ูุงูุฐูุฑ.",
        "๐ค ุจุงุฏุฑ ุจุงูุตูุญ ูุน ูู ุฎุงุตูุชุ ูุฑูุถุงู ุดูุฑ ุงูุชุณุงูุญ.",
        "๐ ูุง ุชูุณู ููุฉ ุงูุตูุงู ูู ูููุฉ.",
        "๐ฏ๏ธ ุญุงูู ุงูุชูููู ูู ุงุณุชุฎุฏุงู ุงููุงุชู ูุงูุชุฑููุฒ ุนูู ุงูุนุจุงุฏุฉ.",
        "๐ ุตูุงุฉ ุงูุชุฑุงููุญ ููุฑ ูููููุ ููุง ุชุญุฑู ููุณู ูููุง.",
        "โจ ุงูุตุฏูุฉ ูู ุฑูุถุงู ูุถุงุนูุฉุ ุชุตุฏู ููู ุจุงููููู."
    ]
};

async function ramadanCommand(sock, chatId, msg, args, commands) {
    const now = moment().tz('Africa/Casablanca');
    const ramadanStart = moment.tz("2026-02-18", "Africa/Casablanca");
    const ramadanEnd = moment.tz("2026-03-20", "Africa/Casablanca"); // Approx 30 days

    let header = `๐ *ุฑูู ุฑูุถุงู ุงููุจุงุฑู* ๐\n\n`;

    // Check if we are in Ramadan
    if (now.isBetween(ramadanStart, ramadanEnd)) {
        const dayOfRamadan = now.diff(ramadanStart, 'days') + 1;
        const progress = Math.min(100, Math.max(0, (dayOfRamadan / 30) * 100));

        header += `โจ ูุญู ุงูููู ูู ุงูููู *${dayOfRamadan}* ูู ุฑูุถุงู 1447ูู\n`;
        header += `๐ ูุณุจุฉ ุงูุงููุถุงุก: [${'โ'.repeat(Math.floor(progress / 10))}${'โ'.repeat(10 - Math.floor(progress / 10))}] ${progress.toFixed(1)}%\n\n`;

        const dua = ramadanData.duas[(dayOfRamadan - 1) % ramadanData.duas.length];
        const tip = ramadanData.tips[(dayOfRamadan - 1) % ramadanData.tips.length];

        header += `๐คฒ *ุฏุนุงุก ุงูููู:* ${dua}\n\n`;
        header += `๐ก *ูุตูุญุฉ ุงูููู:* ${tip}\n\n`;
        header += `โฑ๏ธ ููุนุฑูุฉ ููุงููุช ุงูุฅูุณุงู ูุงูุฅูุทุงุฑุ ุงุณุชุฎุฏู: *.salat*`;
    } else if (now.isBefore(ramadanStart)) {
        const daysToRamadan = ramadanStart.diff(now, 'days');
        const hoursToRamadan = ramadanStart.diff(now, 'hours') % 24;

        header += `โณ ุงููุชุจูู ุนูู ุดูุฑ ุฑูุถุงู ุงููุจุงุฑู:\n`;
        header += `๐๏ธ *${daysToRamadan}* ููู ู *${hoursToRamadan}* ุณุงุนุฉ\n\n`;
        header += `ุงูููู ุจูุบูุง ุฑูุถุงู ูุง ูุงูุฏูู ููุง ููููุฏูู ๐คฒ`;
    } else {
        header += `ุชูุจู ุงููู ููุง ููููู ุตุงูุญ ุงูุฃุนูุงู. ุฑูุถุงู ุงูุชููุ ููุจุณูู ุงููู ูู ุฒููุฉ ุงูุนูุฏ โจ`;
    }

    header += `\n\nโ๏ธ ${config.botName}`;

    await sendWithChannelButton(sock, chatId, header, msg);
}

module.exports = ramadanCommand;
